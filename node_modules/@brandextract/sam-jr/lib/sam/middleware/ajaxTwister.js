/* jslint         indent  : 2,    maxerr   : 50,
  esnext : true, -W030   : true, node     : true
*/
const debug = require('debug')('SAM:ajaxTwister')
const request = require('requisition')

module.exports = (config = {}) => {
  return async (context, next) => {
    let xml, xsl
    debug(`Twisting ${context.query.type}`)

    switch (context.query.type) {
      case 'SAMNews':
        xml = 'http://www.brandextract.com/rss571.xml'
        xsl = '/admin/xsl-library/samLogin/SAMLoginNews.xsl'
        break

      case 'BENews':
        xml = 'http://www.brandextract.com/rss71.xml'
        xsl = '/admin/xsl-library/samLogin/SAMLoginNews.xsl'
        break

      case 'SAMReleases':
        xml = 'http://www.brandextract.com/rss638.xml'
        xsl = '/admin/xsl-library/samLogin/SAMReleaseHistory.xsl'
        break

      case 'SAMMessages':
        xml = 'http://www.brandextract.com/rss569.xml'
        xsl = '/admin/xsl-library/samLogin/SAMImportantMessages.xsl'
        break

      case 'SAMAds':
        xml = 'http://www.brandextract.com/rss578.xml'
        xsl = '/admin/xsl-library/samLogin/SAMLoginAd.xsl'
        break

      default:
        context.body = ''
        return
    }

    const res = await request.get(xml)
    context.body = await res.text()
    context.state.template = `.${xsl}`
    context.state.user = { id: 1 }
  }
}
