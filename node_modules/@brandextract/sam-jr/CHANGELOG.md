# Change log

## 0.17.0

- Reload all files defined in watch pattern.
- Updated dependencies.
- Auto load environment variables from `.env` file.
- Removed `libxslt` and switched to use built-in `xsltproc`.
- [BREAKING] Removed `SAMDirectory`, `-s, --sam-directory` option.
  - Its use case is very limited, and it won't work with `xsltproc`
    due to it requires path to XSL template.
- Added example setup for demonstration and testing.

## 0.16.0

- Fetch missing assets from server and save to disk.
- Only save binary assets such as images. Text content is not saved.
- Added `SAM_TEMPLATES` variable for template base folder.

## 0.15.0

- Split XML into smaller XML files for caching.
- Support override individual nodes, multiple nodes, or everything.

## 0.14.0

- Display parsing error on page instead of "Internal Server Error".
- Reload after fixing parsing error.
- Support auto login through `SAM_USERNAME` and `SAM_PASSWORD` env variables.

## 0.13.0

The new version introduces support for hook. While it's very simple in
design, it allows quite some flexibility when handling with assets.
For example, instead of using client-side CSS preprocessor, which
involves requesting multiple files from the browser, we can use a hook
that can intercept the request for the source style file, and process
it and return the processed result to the browser.

The events include "request", "change", "add", and "remove".

- [BREAKING] [CLI] Removed `-W` option. Just don't use any `-w`.
- [CLI] option `-w` to specify a glob to watch. Can use multiple `-w`.
- Option `hook` to specify a module to run on file events. This module
  must export a function with signature (event, file) for SAM to execute.
- [CLI] option `-hk, --hook` to specify the hook.

## 0.12.0

- Option `SAMDirectory` to specify where to load SAM sources from.
- [CLI] option `-s, --sam-directory` to specify where to load SAM sources from.
- Set correct mime type for XSL files.
- `.cache` folder will be created if not exist.

## 0.11.0

- Set user to guest when not logged in so that the SAM scripts and
  admin bar are not showed.
- Stop populating address bar with query after reload.
- Fixed to work with Node v8.x too.
- Option `useMemory` for `SAM` constructor to toggle in-memory cache.
- [CLI] option `-m, --memory` to use in-memory cache.
- Option `useCache` for `SAM` constructor to toggle file system cache.
- [CLI] option `-C, --no-cache` to skip file system cache.
- [CLI] option `-t, --tunnel` to enable tunneling.
- Option `tokenMaxAge` for `SAM` constructor to specify token's expiration.
- [CLI] option `-e, --max-age` to specify token's expiration.
- Option `cwd` for `SAM` constructor to specify where to run SAM from.
- [CLI] argument `directory` to specify where to run SAM from.

## 0.10.0

- [BREAKING] [CLI] CLI options have higher priority than `process.env`.
- [BREAKING] [CLI] `-t` is removed.
- [CLI] No longer uses Gulp.
- [CLI] Added `-W` to NOT watch.

## 0.9.0

- [BREAKING] Removed support for `filter` query.
- [BREAKING] Switched to use `.cache` folder instead of `data`.
- Support variables in `select` query:
  - `$HOME`: The `/SAM/navigation/link` node for the homepage.
  - `$SITE`: The `/SAM/sites/site` node for the current site.
- Add another in-memory cache layer for the most recent page's XML.

## 0.8.0

- Authentication customization through environment variables:
  - `AUTH_SECRET`
  - `AUTH_COOKIE`
  - `AUTH_DURATION`
  - `AUTH_TOKEN`
- JWT is automatically renewed on each request when it's still valid.
- JWT is also validated against `iss`.

- Support passing queries to `SAM` root node.
- Used `context.query` instead of `context.params` when transforming XSLT.
- Added tests.
- Moved own middlewares to `lib/sam/middleware`.
- Switched to use a robust XPath parser. **NOTE** Some selectors have
  been changed, i.e., `a(b|c)` to `a/b|a/c`. See tests.
- Added own `ajaxTwister` middlerware to load SAM messages.
- Do not require login when local XML data are available.
- Fetch inline content from actual SAM server.

## 0.7.0

- `SAM` class now extends `Koa` instead of creating a `Koa` instance
  inside.
- `require('sam-jr')()` instance will no longer listen. One needs to
  call `.listen(port)` instead.
- `USER_ID` environment variable is no longger used. Instead, ones need
  to login from '/'. The login process only checks for correct user, and
  does not generate session in DB. It does generate a JWT and store in
  cookies.
- `/logoff`.
